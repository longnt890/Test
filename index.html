<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚ù§Ô∏èJ to J</title>
    <link rel="stylesheet" href="styles.css"> <!-- Li√™n k·∫øt ƒë·∫øn file CSS -->

    <script type="module">
        import { Application, Controller } from "https://cdn.jsdelivr.net/npm/@hotwired/stimulus@3.2.2/+esm";
        import confetti from "https://cdn.skypack.dev/canvas-confetti";

        const application = Application.start()

        class GiftBoxController extends Controller {
            static targets = ["emoji", "claimBtn", "message"];

            claim() {
                // Remove the joggle animation to stop continuous rotating.
                this.emojiTarget.classList.remove("joggle");

                // Force a reflow/repaint to reset the state before applying transform transition
                void this.emojiTarget.offsetWidth;

                // Add the class that triggers the smooth transition
                this.emojiTarget.classList.add("gift-box__emoji--claimed");

                this.claimBtnTarget.hidden = true;

                setTimeout(() => {
                    this.messageTarget.classList.remove("gift-box__message--hidden");
                    this.messageTarget.hidden = true;
                    this.emojiTarget.hidden = true;

                    const backgroundContainer = document.getElementById("background-container");

                    setTimeout(() => {
                        backgroundContainer.style.display = "block";
                    }, 2000);

                    const heading = document.querySelector("h1");
                    heading.style.display = "none";

                    confetti({
                        particleCount: 200,
                        spread: 100,
                        origin: { y: 0.25 },
                    });
                }, 500);
            }
        }

        application.register("gift-box", GiftBoxController)


        document.addEventListener('DOMContentLoaded', () => {
            const calendar = document.getElementById('calendar');
            const imageDisplay = document.getElementById('image-display');
            const dayImage = document.getElementById('day-image');
            const backgroundContainer = document.querySelector('.background-container');
            const body = document.body;
            const audio = document.getElementById("background-audio");
            const toggleSoundButton = document.getElementById("toggle-sound");

            const imageToShow1 = 'z6119189044038_36f4ead2ec65f06c1c64483276c11c0c.jpg';
            const imageToShow2 = 'z6119188488855_38c39420d176c4e118c5a316cea27e03.jpg';

            // Ki·ªÉm tra xem l·ªãch ƒë√£ ƒë∆∞·ª£c t·∫°o ch∆∞a
            if (calendar.children.length === 0) {   
                // Generate calendar days
                for (let day = 1; day <= 30; day++) {
                    const dayElement = document.createElement('div');
                    dayElement.className = 'day';
                    dayElement.textContent = day;

                    if (day === 12) {
                        dayElement.addEventListener('click', () => {
                            // Th√™m l·ªõp fade-out cho background-container
                            backgroundContainer.classList.add('fade-out'); // Th√™m l·ªõp fade-out cho background-container
                            calendar.classList.add('fade-out'); // Th√™m l·ªõp fade-out cho l·ªãch

                            setTimeout(() => {
                                showImage(imageToShow1);
                                calendar.style.display = 'none';
                                backgroundContainer.style.display = 'none';
                                imageDisplay.style.display = 'block';
                                body.classList.add('hidden-background');
                            }, 500); // Th·ªùi gian tr√πng kh·ªõp v·ªõi th·ªùi gian hi·ªáu ·ª©ng
                        });
                    }

                    // Ch·ªâ th√™m s·ª± ki·ªán click cho ng√†y 3
                    if (day === 3) {
                        dayElement.addEventListener('click', () => {
                            // Th√™m l·ªõp fade-out cho background-container
                            backgroundContainer.classList.add('fade-out'); // Th√™m l·ªõp fade-out cho background-container
                            calendar.classList.add('fade-out'); // Th√™m l·ªõp fade-out cho l·ªãch

                            setTimeout(() => {
                                showImage(imageToShow2);
                                calendar.style.display = 'none';
                                backgroundContainer.style.display = 'none';
                                imageDisplay.style.display = 'block';
                                body.classList.add('hidden-background');
                            }, 500); // Th·ªùi gian tr√πng kh·ªõp v·ªõi th·ªùi gian hi·ªáu ·ª©ng
                        });
                    }

                    calendar.appendChild(dayElement);
                }
            }

            // Return to calendar when clicking on the image display
            imageDisplay.addEventListener('click', () => {
                imageDisplay.classList.remove('show'); // B·ªè l·ªõp show ƒë·ªÉ b·∫Øt ƒë·∫ßu hi·ªáu ·ª©ng m·ªù
                imageDisplay.classList.add('fade-out'); // Th√™m l·ªõp fade-out

                // ƒê·ª£i m·ªôt ch√∫t tr∆∞·ªõc khi ·∫©n ·∫£nh v√† hi·ªÉn th·ªã l·∫°i l·ªãch
                setTimeout(() => {
                    imageDisplay.style.display = 'none';
                    calendar.classList.remove('fade-out'); // B·ªè l·ªõp fade-out
                    calendar.style.display = 'grid';
                    backgroundContainer.style.display = 'block';
                }, 500); // Th·ªùi gian tr√πng kh·ªõp v·ªõi th·ªùi gian hi·ªáu ·ª©ng
            });

            // Hi·ªÉn th·ªã ·∫£nh khi c·∫ßn thi·∫øt
            function showImage(imageSrc) {
                dayImage.src = imageSrc;
                imageDisplay.style.display = 'block'; // Hi·ªÉn th·ªã ·∫£nh tr∆∞·ªõc

                // Th√™m ƒë·ªô tr·ªÖ tr∆∞·ªõc khi th√™m l·ªõp zoom-in
                setTimeout(() => {
                    imageDisplay.classList.add('zoom-in'); // Th√™m l·ªõp zoom-in
                    imageDisplay.classList.add('show'); // Th√™m l·ªõp show ƒë·ªÉ k√≠ch ho·∫°t hi·ªáu ·ª©ng
                }, 300); // ƒê·ªô tr·ªÖ 300ms tr∆∞·ªõc khi √°p d·ª•ng hi·ªáu ·ª©ng
            }

            document.addEventListener('click', function () {
                var audio = document.getElementById('background-audio');
                audio.play();
            });


            audio.addEventListener('canplaythrough', function () {
                audio.play().catch(error => {
                    console.error('L·ªói khi ph√°t nh·∫°c:', error);
                });
            });

            // ·∫®n background container ban ƒë·∫ßu
            document.getElementById('background-container').style.display = 'none';

        });

    </script>
</head>

<body>
    <div class="mt-40">
        <div class="container text-center">
            <h1 style="justify-content: center; margin-left: 60px;">  ‰π¶ ‚ô° Â≠ù</h1>

            <div class="gift-box" data-controller="gift-box">
                <div class="gift-box__emoji joggle" data-gift-box-target="emoji" data-action="click->gift-box#claim">üéÅ
                </div>

                <div data-gift-box-target="claimBtn">
                </div>

                <div class="gift-box__message gift-box__message--hidden" data-gift-box-target="message">
                    üéâ Gift claimed üéâ
                </div>
            </div>
        </div>
    </div>
    <div class="background-container" id="background-container">
        <div id="calendar">
            <!-- Calendar days will be generated dynamically -->
        </div>
    </div>
    <div id="image-display" style="display: none;">
        <img id="day-image" src="" alt="Day Image">
    </div>

    <script src="script.js"></script> <!-- Li√™n k·∫øt ƒë·∫øn file JavaScript -->
    <!-- Th√™m th·∫ª audio -->
    <audio id="background-audio" autoplay loop preload="auto">
        <source src="audio/music.mp3" type="audio/mp3"> <!-- ƒê∆∞·ªùng d·∫´n ƒë·∫øn t·ªáp √¢m thanh -->
        Your browser does not support the audio element.
    </audio>
</body>

</html>
